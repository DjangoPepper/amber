
<!DOCTYPE html>
<html>

	<head>
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>XLSX For pointeur </title>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.5/xlsx.min.js"></script>

<style>
	table, td, th {
		border: 1px solid;
		border-collapse: collapse;
	}
	td , th {
		padding: 5px;
		width: 100px;
	}
	th {
		background-color: lightgreen;
	}
	#myInput {
		background-image: url('./searchicon.png');
		background-position: 10px 10px;
		background-repeat: no-repeat;
		width: 28%;
		font-size: 16px;
		padding: 12px 20px 12px 40px;
		border: 1px solid #ddd;
		margin-bottom: 12px;
	}

</style>
	</head>

	<body>
		<h1>Upload an excel file to work on shores</h1>
		<!-- Input element to upload an excel file -->
		<input type="file" id="file_upload" />
		<button onclick="upload()">Upload</button>
		<br>
		<br>

		<!-- <form> -->
		<input type="button" class="destination" value="H0" />
		<input type="button" class="destination" value="H1" />
		<input type="button" class="destination" value="H2" />
		<input type="button" class="destination" value="H3" />
		<input type="button" class="destination" value="H4" />
		<input type="button" class="destination" value="H5" />
		<input type="button" class="destination" value="H6" />
		<input type="button" class="destination" value="H7" />
		<input type="button" class="destination" value="H8" />
		<input type="button" class="destination" value="H9" />
		<!-- </form> -->

		<br><br>
		DESTINATION EN COURS : <h2 id="choixdestination"</h2>
		<br><br>

		<h1>Référence Search</h1>
		<input type="text" id="myInput" onkeyup="myFilerFunction()" placeholder="Search for Référence.." title="Type in something">


		<!-- table to display the excel data -->
		<table id="display_excel_data" border="1"></table>

		<script>
			function sortTable(n) {
				var table, rows, switching, i, x, y, shouldSwitch, dir, switchcount = 0;
				table = document.getElementById("display_excel_data");
				switching = true;

				//Set the sorting direction to ascending:
				dir = "asc";

				/*Make a loop that will continue until no switching has been done:*/

				while (switching) {
					//start by saying: no switching is done:
					switching = false;
					rows = table.getElementsByTagName("TR");
					// Loop through all table rows (except the first, which contains table headers):
					for (i = 1; i < rows.length - 1; i++) { //Change i=0 if you have the header th a separate table.
						//start by saying there should be no switching:
						shouldSwitch = false;
						/*Get the two elements you want to compare,
						one from current row and one from the next:*/
						x = rows[i].getElementsByTagName("TD")[n];
						y = rows[i + 1].getElementsByTagName("TD")[n];
						/*check if the two rows should switch place,
						based on the direction, asc or desc:*/
						if (dir == "asc") {
							if (x.innerHTML.toLowerCase() > y.innerHTML.toLowerCase()) {
								//if so, mark as a switch and break the loop:
								shouldSwitch = true;
								break;
							}
						} else if (dir == "desc") {
							if (x.innerHTML.toLowerCase() < y.innerHTML.toLowerCase()) {
								//if so, mark as a switch and break the loop:
								shouldSwitch = true;
								break;
							}
						}
					}
					if (shouldSwitch) {
						// If a switch has been marked, make the switch and mark that a switch has been done:
						rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
						switching = true;
						//Each time a switch is done, increase this count by 1:
						switchcount++;
					} else {
						//If no switching has been done AND the direction is "asc", set the direction to "desc" and run the while loop again.
						if (switchcount == 0 && dir == "asc") {
							dir = "desc";
							switching = true;
						}
					}
				}
			}


			function HProcess(x) {
				var valdest = x.target.value;
				confirm(valdest);
				document.getElementById("choixdestination").innerHTML = valdest;
			}

			Array.from(document.getElementsByClassName("destination")).forEach(function(i){
				i.addEventListener("click", HProcess);
			});

			// Method to upload a valid excel file
			function upload() {
				var files = document.getElementById('file_upload').files;
				if(files.length==0){
					alert("Please choose any file...");
					return;
				}
				var filename = files[0].name;
				var extension = filename.substring(filename.lastIndexOf(".")).toUpperCase();
				if (extension == '.XLS' || extension == '.XLSX') {
						//Here calling another method to read excel file into json
						excelFileToJSON(files[0]);
				}else{
					alert("Please select a valid excel file.");
				}
			}

			//Method to read excel file and convert it into JSON
			function excelFileToJSON(file){
					try {
						var reader = new FileReader();
						reader.readAsBinaryString(file);
						reader.onload = function(e) {

								var data = e.target.result;
								var workbook = XLSX.read(data, {
									type : 'binary'
								});
								var result = {};
								var firstSheetName = workbook.SheetNames[0];
								//reading only first sheet data
								var jsonData = XLSX.utils.sheet_to_json(workbook.Sheets[firstSheetName]);
								//displaying the json result into HTML table
								displayJsonToHtmlTable(jsonData);
								}
						}catch(e){
							console.error(e);
						}
			}

			//Method to display the data in HTML Table
			function displayJsonToHtmlTable(jsonData){
				var table=document.getElementById("display_excel_data");
				if(jsonData.length>0){

					// <th onclick="sortTable(0)">Name</th>

						var htmlData='<tr><th onclick="sortTable(0)">Rang</th><th onclick="sortTable(1)">Référence</th><th>Poids</th><th onclick="sortTable(2)">Position</th><th onclick="sortTable(3)">Destination</th></tr>';
						for(var i=0;i<jsonData.length;i++){
								var row=jsonData[i];
								htmlData+='<tr><td>'+row["Rang"]+'</td><td>'+row["Référence"]
											+'</td><td>'+row["Poids"]+'</td><td>'+row["Position"]
											+'</td><td>'+row["Destination"]+'</td></tr>';
						}
						table.innerHTML=htmlData;
						// console.log(htmlData)
				}else{
						table.innerHTML='There is no data in Excel';
				}
			}

			function myFilerFunction() {
						var input, filter, table, tr, td, i, txtValue;
						input = document.getElementById("myInput");
						filter = input.value.toUpperCase();
						table = document.getElementById("display_excel_data");
						tr = table.getElementsByTagName("tr");
						for (i = 0; i < tr.length; i++) {
							td = tr[i].getElementsByTagName("td")[1];
							if (td) {
								txtValue = td.textContent || td.innerText;
								if (txtValue.toUpperCase().indexOf(filter) > -1) {
									tr[i].style.display = "";
								} else {
									tr[i].style.display = "none";
								}
							}
						}
					}
		</script>
</body>
</html>