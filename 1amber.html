
<!DOCTYPE html>
<html>

	<head>
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>XLSX For pointeur </title>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.5/xlsx.min.js"></script>

<style>
	table, td, th {
		border: 1px solid;
		border-collapse: collapse;
	}
	td , th {
		padding: 5px;
		width: 100px;
	}
	th {
		background-color: lightgreen;
	}
	#myInput {
		background-image: url('./searchicon.png');
		background-position: 10px 10px;
		background-repeat: no-repeat;
		width: 12%;
		font-size: 16px;
		padding: 12px 20px 12px 40px;
		border: 1px solid #ddd;
		margin-bottom: 12px;
	}

</style>
	</head>

	<body>
		<h1>Upload excel file to work</h1>
		<!-- Input element to upload an excel file -->
		<input type="file" id="file_upload" />
		<button onclick="upload()">Upload</button>

		<br><br>
		<input type="button" class="position" value="H0" onclick="validePosition()"/>
		<input type="button" class="position" value="H1" onclick="validePosition()" />
		<input type="button" class="position" value="H2" onclick="validePosition()"/>
		<input type="button" class="position" value="H3" onclick="validePosition()"/>
		<input type="button" class="position" value="H4" onclick="validePosition()"/>
		<input type="button" class="position" value="H5" onclick="validePosition()"/>
		<input type="button" class="position" value="H6" onclick="validePosition()"/>
		<input type="button" class="position" value="H7" onclick="validePosition()"/>
		<input type="button" class="position" value="H8" onclick="validePosition()"/>
		<input type="button" class="position" value="H9" onclick="validePosition()"/>
		<h1>Position : <h1 id="choixPosition"</h1>
		<br><br>
		<input type="button" class="destination" value="H0" onclick="valideDestination()"/>
		<input type="button" class="destination" value="H1" onclick="valideDestination()" />
		<input type="button" class="destination" value="H2" onclick="valideDestination()"/>
		<input type="button" class="destination" value="H3" onclick="valideDestination()"/>
		<input type="button" class="destination" value="H4" onclick="valideDestination()"/>
		<input type="button" class="destination" value="H5" onclick="valideDestination()"/>
		<input type="button" class="destination" value="H6" onclick="valideDestination()"/>
		<input type="button" class="destination" value="H7" onclick="valideDestination()"/>
		<input type="button" class="destination" value="H8" onclick="valideDestination()"/>
		<input type="button" class="destination" value="H9" onclick="valideDestination()"/>
		<h1>Destination : <h1 id="choixDestination"</h1>
		<br>

		<h1>Search
		<input type="text" id="myInput" onkeyup="myFilterFunction()" placeholder="Search for Something.." title="Type in something">
		</h1>


		<!-- table to display the excel data -->
		<table id="display_excel_data" border="1"></table>

		<script>
			var valpos  = "";
			var valdes = "";
			var posSelected = false;
			var desSelected = false;
			var fileSelected = false;

			function sumColumnStock(){
				var table=document.getElementById("display_excel_data");
				var resultSumColumnStock = table.filter(function (table) { return table.destination == valdes;}).reduce(function(_this, val){return _this + val.poids}, 0);
				console.log(resultSumColumnStock);
			}
/*
			function sumStock(){
				var sumTable=document.getElementById("display_excel_data");
				var res = sumTable.map(sumTable => sumTable.Position).reduce((acc, sumTable) => sumTable + acc);
				console.log(res);
			}
 */
			function sumColumnDestination(){
			}

			function sortTable(n){

				const getCellValue = (tr, idx) => tr.children[idx].innerText || tr.children[idx].textContent;

				const comparer = (idx, asc) => (a, b) => ((v1, v2) =>
					v1 !== '' && v2 !== '' && !isNaN(v1) && !isNaN(v2) ? v1 - v2 : v1.toString().localeCompare(v2)
					)(getCellValue(asc ? a : b, idx), getCellValue(asc ? b : a, idx));

				// do the work...
				document.querySelectorAll('th').forEach(th => th.addEventListener('click', (() => {
					const table = th.closest('table');
					Array.from(table.querySelectorAll('tr:nth-child(n+2)'))
						.sort(comparer(Array.from(th.parentNode.children).indexOf(th), this.asc = !this.asc))
						.forEach(tr => table.appendChild(tr) );
				})));
			}

			function validePosition(w) {
				//upload();
				posSelected = true;
				//if ( fileSelected == true) {
					valpos = w.target.value;
					confirm(valpos);
					document.getElementById("choixPosition").innerHTML = valpos;
				//}
				//sumColumnDestination();
			}
			Array.from(document.getElementsByClassName("position")).forEach(function(j){
				j.addEventListener("click", validePosition);
			});

			function valideDestination(x) {
				upload();
				desSelected = true;
				if ( fileSelected == true) {
					valdes = x.target.value;
					confirm(valdes);
					document.getElementById("choixDestination").innerHTML = valdes;
				}
				//sumColumnPosition();
			}
			Array.from(document.getElementsByClassName("destination")).forEach(function(i){
				i.addEventListener("click", valideDestination);
			});

			// Method to upload a valid excel file
			function upload() {
				var files = document.getElementById('file_upload').files;
				if(files.length==0){
					alert("Please choose any file...");
					return;
				}
				var filename = files[0].name;
				var extension = filename.substring(filename.lastIndexOf(".")).toUpperCase();
				if (extension == '.XLS' || extension == '.XLSX') {
						//Here calling another method to read excel file into json
						excelFileToJSON(files[0]);
						fileSelected = true;
				}else{
					alert("Please select a valid excel file.");
				}
			}

			//Method to read excel file and convert it into JSON
			function excelFileToJSON(file){
					try {
						var reader = new FileReader();
						reader.readAsBinaryString(file);
						reader.onload = function(e) {

								var data = e.target.result;
								var workbook = XLSX.read(data, {
									type : 'binary'
								});
								var result = {};
								var firstSheetName = workbook.SheetNames[0];
								//reading only first sheet data
								var jsonData = XLSX.utils.sheet_to_json(workbook.Sheets[firstSheetName]);
								//displaying the json result into HTML table
								displayJsonToHtmlTable(jsonData);
								}
						}catch(e){
							console.error(e);
						}
			}

			//Method to display the data in HTML Table
			function displayJsonToHtmlTable(jsonData){
				var table=document.getElementById("display_excel_data");
				if(jsonData.length>0){
						// <th onclick="sortTable(0)">Name</th>
						var htmlData='<tr><th onclick="sortTable(0)">Rang</th><th onclick="sortTable(1)">Référence</th><th>Poids</th><th onclick="sortTable(2)">Position</th><th onclick="sortTable(3)">Destination</th></tr>';
						for(var i=0;i<jsonData.length;i++){
								var row=jsonData[i];
								htmlData+='<tr><td>'+row["Rang"]+'</td><td>'+row["Référence"]
											+'</td><td>'+row["Poids"]+'</td><td>'+row["Position"]
											+'</td><td>'+row["Destination"]+'</td></tr>';
						}
						table.innerHTML=htmlData;
						// console.log(htmlData)
				}else{
						table.innerHTML='There is no data in Excel';
				}
			}

			function myFilterFunction() {
						var input, filter, table, tr, td, i, txtValue;
						input = document.getElementById("myInput");
						filter = input.value.toUpperCase();
						table = document.getElementById("display_excel_data");
						tr = table.getElementsByTagName("tr");
						for (i = 0; i < tr.length; i++) {
							td = tr[i].getElementsByTagName("td")[1];
							if (td) {
								txtValue = td.textContent || td.innerText;
								if (txtValue.toUpperCase().indexOf(filter) > -1) {
									tr[i].style.display = "";
								} else {
									tr[i].style.display = "none";
								}
							}
						}
					}
		</script>
</body>
</html>